### users

This table represents an individual person with an email identity.

It is used for authentication, team membership, and ownership of timezone state.

It is **not** a profile table (no bios, preferences beyond what’s required for the product).

| **column**        | **type**    | **constraints**  | **notes**                          |
| ----------------- | ----------- | ---------------- | ---------------------------------- |
| id                | uuid        | primary key      | generated server-side              |
| email             | text        | not null, unique | verified email address             |
| email_domain      | text        | not null         | derived from email                 |
| email_verified_at | timestamptz | not null         | set after 8-char code verification |
| created_at        | timestamptz | not null         |                                    |
| updated_at        | timestamptz | not null         |                                    |

#### indexes to be added

- unique index on `email`
- index on `email_domain`

---

### teams

Represents a single team, scoped to **exactly one email domain**.

This table exists to group users and enforce the “one team per domain” rule.

It is **not** a general organization model or multi-team hierarchy.

| **column** | **type**    | **constraints**  | **notes**                   |
| ---------- | ----------- | ---------------- | --------------------------- |
| id         | uuid        | primary key      |                             |
| domain     | text        | not null, unique | one team per domain         |
| name       | text        | not null         | usually derived from domain |
| created_at | timestamptz | not null         |                             |
| updated_at | timestamptz | not null         |                             |

#### indexes to be added

- unique index on `domain`

---

### team_memberships

Joins users to teams and defines their role.

This table enforces team size limits and permissions.

It is **not** used to store activity, presence, or timezone data.

| **column** | **type**    | **constraints**                | **notes**               |
| ---------- | ----------- | ------------------------------ | ----------------------- |
| id         | uuid        | primary key                    |                         |
| team_id    | uuid        | not null, references teams(id) |                         |
| user_id    | uuid        | not null, references users(id) |                         |
| role       | text        | not null                       | enum: `admin`, `member` |
| joined_at  | timestamptz | not null                       |                         |
| created_at | timestamptz | not null                       |                         |

#### indexes to be added

- unique index on `(team_id, user_id)`
- index on `team_id`
- index on `user_id`

---

### invite_codes

Represents **one-time, email-bound invite codes** generated by admins.

Each code can be redeemed only once.

This table is **not** used for domain auto-join (which bypasses invites).

| **column**         | **type**    | **constraints**                | **notes**                   |
| ------------------ | ----------- | ------------------------------ | --------------------------- |
| id                 | uuid        | primary key                    |                             |
| team_id            | uuid        | not null, references teams(id) |                             |
| email              | text        | not null                       | email this code is bound to |
| code               | text        | not null, unique               | 8-character code            |
| expires_at         | timestamptz | not null                       | short-lived                 |
| redeemed_at        | timestamptz | null                           | set on successful join      |
| created_by_user_id | uuid        | not null, references users(id) | admin who generated it      |
| created_at         | timestamptz | not null                       |                             |

#### indexes to be added

- unique index on `code`
- index on `team_id`
- index on `email`

---

### timezone_states

Stores the **latest authoritative timezone state** for a user.

This is the single source of truth for “what timezone is this user in right now”.

It does **not** store history or movement over time.

| **column**         | **type**    | **constraints**                   | **notes**                           |
| ------------------ | ----------- | --------------------------------- | ----------------------------------- |
| user_id            | uuid        | primary key, references users(id) | one row per user                    |
| timezone           | text        | not null                          | IANA timezone, e.g. `Europe/Berlin` |
| utc_offset_minutes | integer     | not null                          | derived at report time              |
| country_code       | text        | not null                          | ISO country code                    |
| reported_at        | timestamptz | not null                          | last device report                  |
| updated_at         | timestamptz | not null                          |                                     |

#### indexes to be added

- primary key on `user_id`
- index on `reported_at`

---

### working_hours

Stores optional working-hours configuration for a user.

This data is used **only for UI hints**, never for availability or enforcement.

It is **not** required for appearing in the app.

| **column**       | **type**    | **constraints**                   | **notes**                      |
| ---------------- | ----------- | --------------------------------- | ------------------------------ |
| user_id          | uuid        | primary key, references users(id) |                                |
| start_minute     | integer     | not null                          | minutes since midnight (local) |
| end_minute       | integer     | not null                          | minutes since midnight (local) |
| saturday_enabled | boolean     | not null                          |                                |
| sunday_enabled   | boolean     | not null                          |                                |
| created_at       | timestamptz | not null                          |                                |
| updated_at       | timestamptz | not null                          |                                |

#### indexes to be added

- primary key on `user_id`

---

### timezone_visibility

Controls whether a user is currently sharing their timezone.

This table enforces **user-controlled hiding** with no admin override.

It is **not** an audit or moderation mechanism.

| **column**          | **type**    | **constraints**                   | **notes**               |
| ------------------- | ----------- | --------------------------------- | ----------------------- |
| user_id             | uuid        | primary key, references users(id) |                         |
| hidden_until        | timestamptz | null                              | null means visible      |
| hidden_indefinitely | boolean     | not null                          |                         |
| last_reminder_at    | timestamptz | null                              | 30-day reminder cadence |
| updated_at          | timestamptz | not null                          |                         |

#### indexes to be added

- primary key on `user_id`
- index on `hidden_until`

---

### email_verification_codes

Stores short-lived email verification codes for signup and login.

This table is **security-sensitive** and should be aggressively cleaned up.

It is **not** reusable for invites.

| **column** | **type**    | **constraints** | **notes**   |
| ---------- | ----------- | --------------- | ----------- |
| id         | uuid        | primary key     |             |
| email      | text        | not null        |             |
| code       | text        | not null        | 8-character |
| expires_at | timestamptz | not null        |             |
| used_at    | timestamptz | null            |             |
| created_at | timestamptz | not null        |             |

#### indexes to be added

- index on `email`
- unique index on `(email, code)`

---

## Explicitly NOT stored

For clarity, the schema intentionally does **not** store:

- IP addresses
- location coordinates
- timezone history
- login activity logs
- “last seen online”
- device identifiers beyond what’s transient
